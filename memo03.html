<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>myMemoPad-è¤‡æ•°å¯¾å¿œ</title>
  <link rel="stylesheet" href="css/style_new.css">
</head>

<body>
  <header>
    <h1>myMemoPad-è¤‡æ•°å¯¾å¿œ</h1>
  </header>

  <main>
    <div id="list_area">
        <h2>ãƒ¡ãƒ¢ä¸€è¦§</h2>
        <ul class="controls">
            <li id="new_memo"> ğŸ“ New Memo</li>
        </ul>
        <ul id="memo_list">
        </ul>
    </div>
    
    <div id="edit_area">
        <input type="text" id="input" placeholder="ãƒ¡ãƒ¢ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›">
        <textarea id="text_area" placeholder="ãƒ¡ãƒ¢ã®å†…å®¹ã‚’å…¥åŠ›"></textarea>

         <ul class="controls">
          <li id="save"> ğŸ’¾ Save</li>
          <li id="clear"> ğŸ—‘ï¸ Delete Memo</li>
         </ul>
    </div>

  </main>

  <footer>
    <small>G's</small>
  </footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script>

    //è¤‡æ•°ãƒ¡ãƒ¢å¯¾å¿œã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
    const STORAGE_KEY = "memo_list_data";
    let currentMemoIndex = -1;

    //LocalStorageã‹ã‚‰ã®ãƒ¡ãƒ¢ã®é…åˆ—ã‚’å–å¾—ã™ã‚‹
    function getMemoList(){
        const json = localStorage.getItem(STORAGE_KEY);
        return json ? JSON.parse(json) : [];
    }

    //LocalStorageã«ãƒ¡ãƒ¢ã®é…åˆ—ã‚’ä¿å­˜ã™ã‚‹
    function saveMemoList(memoList){
        const json = JSON.stringify(memoList);
        localStorage.setItem(STORAGE_KEY, json);
    }

    //ãƒ¡ãƒ¢ä¸€è¦§ã‚’ç”»é¢ã«è¡¨ç¤º
    function renderMemoList(){
        const memoList = getMemoList();
        let html ="";

        memoList.forEach((memo,index)=> {
            const activeClass = index === currentMemoIndex ? "active-selected" : "";
            html += `<li data-index="${index}" class="${activeClass}">${memo.title ||"(ç„¡é¡Œã®ãƒ¡ãƒ¢)"}</li>`;
        });

        $("#memo_list").html(html);

        //ãƒ¡ãƒ¢ä¸€è¦§ã«è¨­å®š
        $("#memo_list li").on("click", function(){
            const index = $(this).data("index");
            loadMemo(index);
        });
    }

    //æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ¡ãƒ¢ã‚’ç·¨é›†ã‚¨ãƒªã‚¢ã«ãƒ­ãƒ¼ãƒ‰
    function loadMemo(index){
        const memoList = getMemoList();
        if(index >= 0 && index < memoList.length){
            const memo = memoList[index];
            $("#input").val(memo.title);
            $("#text_area").val(memo.text);
            currentMemoIndex = index;
            //ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
            $("#memo_list li").removeClass("active-selected");
            $(`li[data-index="${index}"]`).addClass("active-selected");
        }
    }

    //æ–°è¦ãƒ¡ãƒ¢ä½œæˆãƒœã‚¿ãƒ³
    $("#new_memo").on("click", function(){
        //å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
        $("#input").val("");
        $("#text_area").val("")
        //æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰ã«è¨­å®š
        currentMemoIndex = -1;
        $("#memo_list li").removeClass("active-selected");
        $("#input").focus();
    });

    //ä¿å­˜
    $("#save").on("click",function(){
        const memoList = getMemoList();
        const newTitle = $("#input").val() ||"(ç„¡é¡Œã®ãƒ¡ãƒ¢)"
        const newText = $("#text_area").val();

        const newMemo ={
            title: newTitle,
            text:newText,
            timestamp: Date.now()
        };

        if(currentMemoIndex === -1){
            memoList.push(newMemo);
            currentMemoIndex = memoList.length -1;
            alert("æ–°ã—ã„ãƒ¡ãƒ¢ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼");
        } else {
            memoList[currentMemoIndex] = newMemo;
            alert(`ã€Œ${newTitle}ã€ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼`);
        }

        saveMemoList(memoList);
        renderMemoList();
        //ä¿å­˜å¾Œã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ç¶­æŒ
        $(`li[data-index="${currentMemoIndex}"]`).addClass("active-selected");
    });

    //å‰Šé™¤å‡¦ç†
    $("#clear").on("click",function(){
        if(currentMemoIndex === -1){
            alert("å‰Šé™¤ã™ã‚‹ãƒ¡ãƒ¢ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
            return;
        }

        const memoList = getMemoList();
        const titleToDelete = memoList[currentMemoIndex].title;
        if(!confirm(`ã€Œ${titleToDelete}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)){
            return;
        }

    //é…åˆ—ã‹ã‚‰è©²å½“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤
    memoList.splice(currentMemoIndex, 1);
    saveMemoList(memoList);

    //ç·¨é›†ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢ã—ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
    $("#input").val("");
    $("#text_area").val("");
    currentMemoIndex = -1;

    renderMemoList();
    alert("ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
    });

    //ç”»é¢èµ·å‹•æ™‚ã®åˆæœŸå‡¦ç†
    $(document).ready(function(){
        const memoList = getMemoList();
        if(memoList.length > 0) {
            loadMemo(0);
        }else{
            currentMemoIndex = -1;
        }
        renderMemoList();
    });
 
  </script>

</body>

</html>